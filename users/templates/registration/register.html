{% load static %}
<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <title>–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div class="container" style="max-width: 500px; margin-top: 50px;">
        <div class="card shadow" style="padding: 30px; border-radius: 15px; background: white;">
            <h2 class="text-center">üìù –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</h2>
            <p class="text-center text-muted">–°—Ç–≤–æ—Ä—ñ—Ç—å –ø—Ä–æ—Ñ—ñ–ª—å –¥–ª—è –ø–æ–¥–∞—á—ñ –ø–æ–∫–∞–∑–Ω–∏–∫—ñ–≤</p>
            <hr>

            <form method="post" id="registrationForm">
                {% csrf_token %}

                {% for field in form %}
                    <div class="form-group" style="margin-bottom: 15px;">
                        <label><strong>{{ field.label }}</strong></label>
                        {{ field }}
                        {% if field.help_text %}
                            <small class="text-muted" style="display: block;">{{ field.help_text }}</small>
                        {% endif %}
                        {% for error in field.errors %}
                            <p style="color: red; font-size: 0.8rem;">{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endfor %}

                <div id="coop-info" style="margin: 10px 0; padding: 10px; border-radius: 5px; display: none;">
                    <span id="coop-message"></span>
                </div>

                <button type="submit" class="btn btn-success" style="width: 100%; padding: 10px; background-color: #2ecc71; border: none; color: white; border-radius: 5px; cursor: pointer; font-weight: bold;">
                    –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –∑–∞—è–≤–∫—É
                </button>
            </form>

            <div style="text-align: center; margin-top: 20px;">
                <a href="{% url 'home' %}" style="text-decoration: none; color: #7f8c8d;">‚¨ÖÔ∏è –°–∫–∞—Å—É–≤–∞—Ç–∏ —Ç–∞ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è</a>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            // –ó–Ω–∞—Ö–æ–¥–∏–º–æ –ø–æ–ª—è –∑–∞ —ó—Ö ID (—è–∫—ñ –º–∏ –ø—Ä–æ–ø–∏—Å–∞–ª–∏ –≤ forms.py)
            const coopInput = $('#id_coop_id');
            const streetSelect = $('#id_street');
            const infoBox = $('#coop-info');
            const messageSpan = $('#coop-message');

            coopInput.on('input', function() {
                const coopId = $(this).val();

                if (coopId.length > 0) {
                    $.ajax({
                        url: "{% url 'check_coop_id' %}",
                        data: { 'coop_id': coopId },
                        success: function(data) {
                            if (data.exists) {
                                // 1. –ü–æ–∫–∞–∑—É—î–º–æ —É—Å–ø—ñ—Ö —ñ –Ω–∞–∑–≤—É
                                infoBox.show().css('background-color', '#d4edda').css('color', '#155724');
                                messageSpan.text("‚úÖ –ö–æ–æ–ø–µ—Ä–∞—Ç–∏–≤ –∑–Ω–∞–π–¥–µ–Ω–æ: " + data.name);

                                // 2. –û—á–∏—â—É—î–º–æ —Ç–∞ –∑–∞–ø–æ–≤–Ω—é—î–º–æ —Å–ø–∏—Å–æ–∫ –≤—É–ª–∏—Ü—å
                                streetSelect.empty();
                                streetSelect.append('<option value="">-- –û–±–µ—Ä—ñ—Ç—å –≤—É–ª–∏—Ü—é --</option>');
                                data.streets.forEach(function(street) {
                                    streetSelect.append('<option value="' + street + '">' + street + '</option>');
                                });
                                streetSelect.parent().show(); // –ü–æ–∫–∞–∑—É—î–º–æ –ø–æ–ª–µ –≤—É–ª–∏—Ü—ñ
                            } else {
                                // –Ø–∫—â–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ
                                infoBox.show().css('background-color', '#f8d7da').css('color', '#721c24');
                                messageSpan.text("‚ùå –ö–æ–æ–ø–µ—Ä–∞—Ç–∏–≤ –∑ —Ç–∞–∫–∏–º ID –Ω–µ —ñ—Å–Ω—É—î");
                                streetSelect.empty().parent().hide();
                            }
                        }
                    });
                } else {
                    infoBox.hide();
                    streetSelect.parent().hide();
                }
            });
        });
    </script>
</body>
</html>