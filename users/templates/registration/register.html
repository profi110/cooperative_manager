{% load static %}
<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <title>–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</title>
</head>
<body>
    <div class="container" style="max-width: 500px; margin-top: 50px;">
        <div class="card shadow" style="padding: 30px; border-radius: 15px; background: white;">
            <h2 class="text-center">üìù –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</h2>
            <hr>

            <form method="post" id="registrationForm">
                {% csrf_token %}

                {% for field in form %}
                    <div class="form-group" style="margin-bottom: 15px;">
                        <label><strong>{{ field.label }}</strong></label>
                        {{ field }}
                        {% for error in field.errors %}
                            <p style="color: red; font-size: 0.8rem;">{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endfor %}

                <div id="coop-info" style="margin: 10px 0; padding: 10px; border-radius: 5px; display: none;">
                    <span id="coop-message"></span>
                </div>

                <button type="submit" class="btn btn-success" style="width: 100%; padding: 10px; background-color: #2ecc71; border: none; color: white; border-radius: 5px; cursor: pointer; font-weight: bold;">
                    –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –∑–∞—è–≤–∫—É
                </button>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const coopInput = document.getElementById('id_coop_id');
            const streetSelect = document.getElementById('id_street');
            const infoBox = document.getElementById('coop-info');
            const messageSpan = document.getElementById('coop-message');

            coopInput.addEventListener('input', function() {
                const coopId = this.value;

                if (coopId.length > 0) {
                    // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ fetch –∑–∞–º—ñ—Å—Ç—å AJAX
                    fetch(`{% url 'check_coop_id' %}?coop_id=${coopId}`)
                        .then(response => {
                            if (!response.ok) throw new Error('Network response was not ok');
                            return response.json();
                        })
                        .then(data => {
                            if (data.exists) {
                                // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–∏ —É—Å–ø—ñ—à–Ω–æ–º—É –ø–æ—à—É–∫—É
                                infoBox.style.display = 'block';
                                infoBox.style.backgroundColor = '#d4edda';
                                infoBox.style.color = '#155724';
                                messageSpan.textContent = "‚úÖ –ö–æ–æ–ø–µ—Ä–∞—Ç–∏–≤ –∑–Ω–∞–π–¥–µ–Ω–æ: " + data.name;

                                // –û—á–∏—â–µ–Ω–Ω—è —Ç–∞ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É –≤—É–ª–∏—Ü—å
                                streetSelect.innerHTML = '<option value="">-- –û–±–µ—Ä—ñ—Ç—å –≤—É–ª–∏—Ü—é --</option>';
                                data.streets.forEach(street => {
                                    const option = document.createElement('option');
                                    option.value = street;
                                    option.textContent = street;
                                    streetSelect.appendChild(option);
                                });
                                streetSelect.parentElement.style.display = 'block';
                            } else {
                                // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è, —è–∫—â–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ
                                infoBox.style.display = 'block';
                                infoBox.style.backgroundColor = '#f8d7da';
                                infoBox.style.color = '#721c24';
                                messageSpan.textContent = "‚ùå –ö–æ–æ–ø–µ—Ä–∞—Ç–∏–≤ –∑ —Ç–∞–∫–∏–º ID –Ω–µ —ñ—Å–Ω—É—î";
                                streetSelect.innerHTML = '';
                                streetSelect.parentElement.style.display = 'none';
                            }
                        })
                        .catch(error => {
                            console.error('–ü–æ–º–∏–ª–∫–∞ Fetch:', error);
                        });
                } else {
                    infoBox.style.display = 'none';
                    streetSelect.parentElement.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>