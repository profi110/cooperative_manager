{% extends 'base.html' %}

{% block content %}
    {% include 'staff/navbar.html' %}

    <div class="container mt-5">
        <div class="card shadow-sm mx-auto" style="max-width: 600px;">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">
                    üìä –î–æ–¥–∞—Ç–∏ –ø–æ–∫–∞–∑–Ω–∏–∫–∏: {{ target_member.user.get_full_name|default:target_member.user.username }}
                </h5>
            </div>

            <div class="card-body">
                {% if not is_window_open %}
                    <div class="alert alert-danger shadow-sm">
                        ‚õîÔ∏è <strong>–ü–æ–¥–∞—á–∞ –∑–∞–∫—Ä–∏—Ç–∞!</strong><br>
                        –ü—Ä–∏–π–æ–º –ø–æ–∫–∞–∑–Ω–∏–∫—ñ–≤ –¥–æ–∑–≤–æ–ª–µ–Ω–æ –ª–∏—à–µ –≤ <strong>–æ—Å—Ç–∞–Ω–Ω—ñ–π –¥–µ–Ω—å –º—ñ—Å—è—Ü—è</strong> –∞–±–æ <strong>1-–≥–æ —á–∏—Å–ª–∞</strong>.
                    </div>
                {% elif has_reading %}
                    <div class="alert alert-warning shadow-sm">
                        ‚úÖ <strong>–ü–æ–∫–∞–∑–Ω–∏–∫–∏ –≤–∂–µ –ø–æ–¥–∞–Ω–æ!</strong><br>
                        –ó–∞ –ø–æ—Ç–æ—á–Ω–∏–π –∑–≤—ñ—Ç–Ω–∏–π –ø–µ—Ä—ñ–æ–¥ –¥–∞–Ω—ñ –¥–ª—è —Ü—å–æ–≥–æ –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞ –≤–∂–µ –≤–Ω–µ—Å–µ–Ω–æ.
                    </div>
                {% endif %}

                <div class="alert alert-light border mb-4">
                    <div class="row">
                        <div class="col-md-6">
                            <small class="text-muted d-block">–ê–¥—Ä–µ—Å–∞:</small>
                            <strong>{{ target_member.street.name }}, {{ target_member.plot_number }}</strong>
                        </div>
                        <div class="col-md-6">
                            <small class="text-muted d-block">–õ—ñ—á–∏–ª—å–Ω–∏–∫:</small>
                            <strong>‚Ññ{{ meter.number }}</strong>
                            {% if meter.is_two_zone %}
                                <span class="badge badge-info">–î–µ–Ω—å/–ù—ñ—á</span>
                            {% else %}
                                <span class="badge badge-secondary">–ó–≤–∏—á–∞–π–Ω–∏–π</span>
                            {% endif %}
                        </div>
                    </div>
                </div>

                {% if previous %}
                    <div class="alert alert-warning small">
                        <strong>–û—Å—Ç–∞–Ω–Ω—ñ –∑–∞—Ñ—ñ–∫—Å–æ–≤–∞–Ω—ñ –ø–æ–∫–∞–∑–Ω–∏–∫–∏ ({{ previous.date|date:"d.m.Y" }}):</strong>
                        <hr class="my-1">
                        {% if meter.is_two_zone %}
                            <div>‚òÄÔ∏è –î–µ–Ω—å: <strong>{{ previous.value_day }}</strong></div>
                            <div>üåë –ù—ñ—á: <strong>{{ previous.value_night }}</strong></div>
                        {% else %}
                            <div>‚ö°Ô∏è –ó–∞–≥–∞–ª—å–Ω–∏–π: <strong>{{ previous.value_total }}</strong></div>
                        {% endif %}
                    </div>
                {% else %}
                    <div class="alert alert-info small">
                        –¶–µ –ø–µ—Ä—à—ñ –ø–æ–∫–∞–∑–Ω–∏–∫–∏ –¥–ª—è —Ü—å–æ–≥–æ –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞. –ü–æ—á–∞—Ç–∫–æ–≤–µ –∑–Ω–∞—á–µ–Ω–Ω—è: <strong>{{ meter.initial_value }}</strong>
                    </div>
                {% endif %}

                <form method="post">
                    {% csrf_token %}

                    <fieldset {% if not is_window_open or has_reading %}disabled{% endif %}>

                        {% if meter.is_two_zone %}
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label>‚òÄÔ∏è –î–µ–Ω—å (–∫–í—Ç)</label>
                                    <input type="number" step="0.01" name="value_day" class="form-control" required>
                                </div>
                                <div class="form-group col-md-6">
                                    <label>üåë –ù—ñ—á (–∫–í—Ç)</label>
                                    <input type="number" step="0.01" name="value_night" class="form-control" required>
                                </div>
                            </div>
                        {% else %}
                            <div class="form-group">
                                <label>‚ö°Ô∏è –ü–æ—Ç–æ—á–Ω–∏–π –ø–æ–∫–∞–∑–Ω–∏–∫ (–∫–í—Ç)</label>
                                <input type="number" step="0.01" name="value_total" class="form-control" required>
                            </div>
                        {% endif %}

                        <div class="mt-4">
                            <button type="submit" class="btn btn-success btn-block btn-lg shadow-sm">
                                üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –ø–æ–∫–∞–∑–Ω–∏–∫–∏
                            </button>
                        </div>
                    </fieldset>

                    <a href="{% url 'staff_readings' %}" class="btn btn-link btn-block text-muted mt-2">
                        –°–∫–∞—Å—É–≤–∞—Ç–∏ / –ù–∞–∑–∞–¥
                    </a>
                </form>
            </div>
        </div>
    </div>
{% endblock %}